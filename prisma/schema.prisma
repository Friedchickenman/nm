// prisma/schema.prisma

// 1. Prisma í´ë¼ì´ì–¸íŠ¸ ì„¤ì • (ê±´ë“œë¦¬ì§€ ë§ˆì„¸ìš”!)
generator client {
  provider = "prisma-client-js"
}

// 2. DB ì—°ê²° ì„¤ì • (ë‚˜ì¤‘ì— .env íŒŒì¼ì— ì£¼ì†Œë§Œ ë„£ìœ¼ë©´ ë¨)
datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ==========================================
// ğŸ“Œ ì—¬ê¸°ì„œë¶€í„° í…Œì´ë¸”(Entity) ì •ì˜ ì‹œì‘!
// ==========================================

// 3. ì‚¬ìš©ì (User) - NextAuth(ë¡œê·¸ì¸) í•„ìˆ˜ ëª¨ë¸
model User {
  id            String    @id @default(cuid()) // PK (UUID ìë™ìƒì„±)
  name          String?   // ë‹‰ë„¤ì„
  email         String?   @unique // ì´ë©”ì¼ (ì¤‘ë³µ ë¶ˆê°€)
  emailVerified DateTime?
  image         String?   // í”„ë¡œí•„ ì‚¬ì§„ URL

  accounts      Account[] // ì†Œì…œ ë¡œê·¸ì¸ ì •ë³´ (1:N)
  sessions      Session[] // ë¡œê·¸ì¸ ì„¸ì…˜ (1:N)
  reviews       Review[]  // ìœ ì €ê°€ ì“´ ë¦¬ë·°ë“¤ (1:N)

  createdAt     DateTime  @default(now()) // ê°€ì…ì¼
  updatedAt     DateTime  @updatedAt      // ìˆ˜ì •ì¼
}

// 4. ì†Œì…œ ë¡œê·¸ì¸ ê³„ì • ì •ë³´ (ì¹´ì¹´ì˜¤, êµ¬ê¸€ ë“±)
model Account {
  id                 String  @id @default(cuid())
  userId             String
  type               String
  provider           String  // "kakao", "google" ë“±
  providerAccountId  String  // í•´ë‹¹ í”Œë«í¼ì—ì„œì˜ ID
  refresh_token      String? @db.Text
  access_token       String? @db.Text
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String? @db.Text
  session_state      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

// 5. ë¡œê·¸ì¸ ì„¸ì…˜ ê´€ë¦¬
model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// 6. ğŸ¬ ì˜í™” ë¦¬ë·° (í•µì‹¬ ê¸°ëŠ¥!)
model Review {
  id        String   @id @default(cuid())
  content   String   @db.Text // ë¦¬ë·° ë‚´ìš© (ê¸¸ê²Œ ì“¸ ìˆ˜ ìˆìŒ)
  rating    Int      // ë³„ì  (1~5) or (1~10)

  // ì˜í™” ì •ë³´ëŠ” ë§¤ë²ˆ API ë¶€ë¥´ê¸° ê·€ì°®ìœ¼ë‹ˆ DBì—ë„ ì €ì¥
  movieId   String   // TMDB ì˜í™” ID (ìˆ«ìì§€ë§Œ ë¬¸ìì—´ë¡œ ê´€ë¦¬ ì¶”ì²œ)
  movieTitle String  // ì˜í™” ì œëª©
  movieImage String? // ì˜í™” í¬ìŠ¤í„° URL

  // ì‘ì„±ì ì •ë³´
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) // ì‘ì„±ì¼
  updatedAt DateTime @updatedAt      // ìˆ˜ì •ì¼

  // ğŸ” ê²€ìƒ‰ ìµœì í™” (ì¸ë±ìŠ¤)
  @@index([movieId]) // "ì´ ì˜í™”ì˜ ë¦¬ë·°ë§Œ ê°€ì ¸ì™€!" í•  ë•Œ ë¹ ë¥´ê²Œ
  @@index([userId])  // "ì´ ì‚¬ëŒì´ ì“´ ë¦¬ë·°ë§Œ ê°€ì ¸ì™€!" í•  ë•Œ ë¹ ë¥´ê²Œ
}

// 7. ì´ë©”ì¼ ì¸ì¦ í† í° (ë¡œê·¸ì¸ìš©)
model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}